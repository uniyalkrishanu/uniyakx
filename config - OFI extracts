{
	"output": {
		"type": "s3",
		"outputbucket": "aegon-publication-datalake-store-qa",
		"outputfolder": "ofidump_finance",
		"publicationfolder": "aegon-publication/ofi",		
		"outputformat": "csv",
		"seperator": ",",
		"calllambda":"aegon-publish-to-database-qa"
	},	
	"queries": [{
			"inputentities": "financeadapter-activity",
			"resultClass": "HM_OFI_ACTIVITY",
			"publicationclass" : "activity_hm",			
			"optionalfields": [],			
			"sql": "select FINANCE_EXTRACT_ID,EVENT,TASK,TRANSACTION_DATE,POLICY_NUMBER,URBAN_RURAL_SOCIAL,PRODUCT_CODE,PREMIUM_TYPE,AMOUNT,TRANSACTION_ID,PAYMENT_MODE,SOURCING_CHANNEL,SOURCING_SUB_CHANNEL,AGENT_CODE,AGENT_STATUS,COMMISIONABLE,SOURCING_BRANCH_CODE,RECEIPTING_BRANCH_CODE,LOS,POS,CUST_GST_NO,INVOICE_NO,REF_INVOICE_NO,PAYMENT_TYPE, CUSTOMER_NAME,SUPPLIER,VOUCHER_NO,DOC_REF,CHECK_NO,SUPPLIER_CODE,CREATED_ON from(select FINANCE_EXTRACT_ID,EVENT,TASK,TRANSACTION_DATE,POLICY_NUMBER,URBAN_RURAL_SOCIAL,PRODUCT_CODE,PREMIUM_TYPE,AMOUNT,TRANSACTION_ID,PAYMENT_MODE,SOURCING_CHANNEL,SOURCING_SUB_CHANNEL,AGENT_CODE,AGENT_STATUS,COMMISIONABLE,SOURCING_BRANCH_CODE,RECEIPTING_BRANCH_CODE,LOS,POS,CUST_GST_NO,INVOICE_NO,REF_INVOICE_NO,PAYMENT_TYPE, CUSTOMER_NAME,SUPPLIER,VOUCHER_NO,DOC_REF,CHECK_NO,SUPPLIER_CODE,CREATED_ON, ROW_NUMBER() over(partition by EVENT,TASK,TRANSACTION_DATE,POLICY_NUMBER,AMOUNT,TRANSACTION_ID,PAYMENT_TYPE,DUE_DATE order by FINANCE_EXTRACT_ID desc) AS RNK from(select a.FINANCE_EXTRACT_ID ,EVENT,TASK,date_format(from_utc_timestamp(TRANSACTION_DATE,'IST'),'dd-MMM-yy') AS TRANSACTION_DATE,POLICY_NUMBER,CASE WHEN URBAN_RURAL_SOCIAL = 'RURAL' THEN 'R' WHEN URBAN_RURAL_SOCIAL='SOCIAL' THEN 'S' ELSE 'U' END AS URBAN_RURAL_SOCIAL,CASE WHEN PRODUCT_CODE = '' THEN 'ARMP0000000' ELSE PRODUCT_CODE END AS PRODUCT_CODE,CASE WHEN PREMIUM_TYPE = 'SINGLE' THEN 'SINGLE' ELSE 'REGULAR' END AS PREMIUM_TYPE, CAST(AMOUNT as DECIMAL(10,2))  AS AMOUNT,TRANSACTION_ID,CASE WHEN (PAYMENT_MODE = 'dd' or PAYMENT_MODE = 'cheque') THEN 'cc' ELSE PAYMENT_MODE END AS PAYMENT_MODE,CASE WHEN SOURCING_CHANNEL = '' THEN '0000' ELSE SOURCING_CHANNEL END AS SOURCING_CHANNEL,CASE WHEN SOURCING_SUB_CHANNEL = '' THEN '0000' ELSE SOURCING_SUB_CHANNEL END AS SOURCING_SUB_CHANNEL,AGENT_CODE,'' AS AGENT_STATUS,'' AS COMMISIONABLE,CASE WHEN SOURCING_BRANCH_CODE = '' THEN '100' ELSE SOURCING_BRANCH_CODE END AS SOURCING_BRANCH_CODE,RECEIPTING_BRANCH_CODE,CASE WHEN LOS='AN' THEN '35' WHEN LOS='AP' THEN '37' WHEN LOS='AR' THEN '12' WHEN LOS='AS' THEN '18' WHEN LOS='BR' THEN '10' WHEN LOS='CH' THEN '4' WHEN LOS='CT' THEN '22' WHEN LOS='DN' THEN '26' WHEN LOS='DD' THEN '25' WHEN LOS='DL' THEN '7' WHEN LOS='GA' THEN '30' WHEN LOS='GJ' THEN '24' WHEN LOS='HR' THEN '6' WHEN LOS='HP' THEN '2' WHEN LOS='JK' THEN '1' WHEN LOS='JH' THEN '20' WHEN LOS='KA' THEN '29' WHEN LOS='KL' THEN '32' WHEN LOS='LD' THEN '31' WHEN LOS='MP' THEN '23' WHEN LOS='MH' THEN '27' WHEN LOS='MN' THEN '14' WHEN LOS='ML' THEN '17' WHEN LOS='MZ' THEN '15' WHEN LOS='NL' THEN '13' WHEN LOS='OR' THEN '21' WHEN LOS='PY' THEN '34' WHEN LOS='PB' THEN '3' WHEN LOS='RJ' THEN '8' WHEN LOS='SK' THEN '11' WHEN LOS='TN' THEN '33' WHEN LOS='TG' THEN '36' WHEN LOS='TR' THEN '16' WHEN LOS='UP' THEN '9' WHEN LOS='UT' THEN '5' WHEN LOS='WB' THEN '19' ELSE '' END AS LOS,CASE WHEN POS='AN' THEN '35' WHEN POS='AP' THEN '37' WHEN POS='AR' THEN '12' WHEN POS='AS' THEN '18' WHEN POS='BR' THEN '10' WHEN POS='CH' THEN '4' WHEN POS='CT' THEN '22' WHEN POS='DN' THEN '26' WHEN POS='DD' THEN '25' WHEN POS='DL' THEN '7' WHEN POS='GA' THEN '30' WHEN POS='GJ' THEN '24' WHEN POS='HR' THEN '6' WHEN POS='HP' THEN '2' WHEN POS='JK' THEN '1' WHEN POS='JH' THEN '20' WHEN POS='KA' THEN '29' WHEN POS='KL' THEN '32' WHEN POS='LD' THEN '31' WHEN POS='MP' THEN '23' WHEN POS='MH' THEN '27' WHEN POS='MN' THEN '14' WHEN POS='ML' THEN '17' WHEN POS='MZ' THEN '15' WHEN POS='NL' THEN '13' WHEN POS='OR' THEN '21' WHEN POS='PY' THEN '34' WHEN POS='PB' THEN '3' WHEN POS='RJ' THEN '8' WHEN POS='SK' THEN '11' WHEN POS='TN' THEN '33' WHEN POS='TG' THEN '36' WHEN POS='TR' THEN '16' WHEN POS='UP' THEN '9' WHEN POS='UT' THEN '5' WHEN POS='WB' THEN '19' ELSE '' END AS POS,CUST_GST_NO, INVOICE_NO,REF_INVOICE_NO,PAYMENT_TYPE,DUE_DATE, CUSTOMER_NAME,CASE WHEN (EVENT = 'FREELOOK_MONEYOUT' or EVENT = 'FREELOOK_PAYMENT') THEN 'FREE_LOOK_PAYABLE' WHEN (EVENT = 'REFUND_PAY' or EVENT = 'PREISSUANCE_CANC_PAY') and (PAYMENT_MODE = 'cc' or PAYMENT_MODE = 'ib')  THEN 'REFUNDS-PAYABLE-ONLINE' WHEN (EVENT = 'REFUND_PAY' or EVENT = 'PREISSUANCE_CANC_PAY') THEN 'REFUND-PAYABLE' ELSE '' END AS SUPPLIER,VOUCHER_NO,a.FINANCE_EXTRACT_ID AS DOC_REF, CHECK_NO, CASE WHEN (EVENT = 'FREELOOK_MONEYOUT' or EVENT = 'FREELOOK_PAYMENT') THEN 'FRE0001' WHEN  (EVENT = 'REFUND_PAY' or EVENT = 'PREISSUANCE_CANC_PAY') and (PAYMENT_MODE = 'cc' or PAYMENT_MODE = 'ib')  THEN 'REF0002' WHEN (EVENT = 'REFUND_PAY' or EVENT = 'PREISSUANCE_CANC_PAY') THEN 'REF0001' ELSE '' END AS SUPPLIER_CODE, date_format(CREATED_ON,'dd-MMM-yy') AS CREATED_ON from financeadapter_activity a) b) c where FINANCE_EXTRACT_ID in ('202003117088266','202003119388786','202003114805649','202003118207528','202003118695036','202003115717325','202003118734198','202003119369422','202003115314403','202003116268221','202003118342519','202003119615968','202003118354122','202003118883767','202003117647797','202003117044931','202003113753471','202003118608259','202003113961402','202003113972940','202003114719557','202003119269057','202003115921989','202003114919791','202003116020625','202003119580777','202003117063107','202003113997623','202003111644579','202003115947803','202003116479723','202003111053870') and POLICY_NUMBER NOT IN ('ALI444000000667')"
		},{ 
			"inputentities": "financeadapter-breakdown,financeadapter-activity",
			"resultClass": "HM_OFI_ACTIVITY_BREAKDOWN",
			"publicationclass" : "breakdown_hm",			
			"optionalfields": [],			
			"sql": "select FINANCE_EXTRACT_ID,replace(PREMIUM_INDICATOR, '-', '_') AS PREMIUM_INDICATOR,'PREMIUM' AS PREMIUM_BREAKDOWN_INDICATOR, CAST(AMOUNT as DECIMAL(10,2))  AS AMOUNT,PREM_GST_RATE AS GST_RATE,case WHEN YOP = 0 THEN 1 ELSE YOP END AS YOP from financeadapter_breakdown where PREMIUM_INDICATOR != 'MEDICAL'  and AMOUNT > 0.0  and  FINANCE_EXTRACT_ID in (SELECT FINANCE_EXTRACT_ID from financeadapter_activity a  where  a.FINANCE_EXTRACT_ID in  ('202003117088266','202003119388786','202003114805649','202003118207528','202003118695036','202003115717325','202003118734198','202003119369422','202003115314403','202003116268221','202003118342519','202003119615968','202003118354122','202003118883767','202003117647797','202003117044931','202003118608259','202003113961402','202003113972940','202003119269057','202003115921989','202003114919791','202003116020625','202003119580777','202003117063107','202003113997623','202003111644579','202003115947803','202003116479723','202003111053870')) union select FINANCE_EXTRACT_ID,replace(PREMIUM_INDICATOR, '-', '_') AS PREMIUM_INDICATOR,'CGST' AS PREMIUM_BREAKDOWN_INDICATOR,  CAST(cGstAmount as DECIMAL(10,2))  AS AMOUNT,CGST_RATE AS GST_RATE,case WHEN YOP = 0 THEN 1 ELSE YOP END AS YOP from financeadapter_breakdown where PREMIUM_INDICATOR != 'MEDICAL'  and cGstAmount > 0.0 and  FINANCE_EXTRACT_ID in (SELECT FINANCE_EXTRACT_ID from financeadapter_activity a  where  a.FINANCE_EXTRACT_ID in  ('202003117088266','202003119388786','202003114805649','202003118207528','202003118695036','202003115717325','202003118734198','202003119369422','202003115314403','202003116268221','202003118342519','202003119615968','202003118354122','202003118883767','202003117647797','202003117044931','202003118608259','202003113961402','202003113972940','202003119269057','202003115921989','202003114919791','202003116020625','202003119580777','202003117063107','202003113997623','202003111644579','202003115947803','202003116479723','202003111053870')) union select FINANCE_EXTRACT_ID,replace(PREMIUM_INDICATOR, '-', '_') AS PREMIUM_INDICATOR,'SGST' AS PREMIUM_BREAKDOWN_INDICATOR, CAST(sGstAmount as DECIMAL(10,2))  AS AMOUNT,SGST_RATE AS GST_RATE,case WHEN YOP = 0 THEN 1 ELSE YOP END AS YOP from financeadapter_breakdown where PREMIUM_INDICATOR != 'MEDICAL'  and sGstAmount > 0.0  and  FINANCE_EXTRACT_ID in (SELECT FINANCE_EXTRACT_ID from financeadapter_activity a  where  a.FINANCE_EXTRACT_ID in  ('202003117088266','202003119388786','202003114805649','202003118207528','202003118695036','202003115717325','202003118734198','202003119369422','202003115314403','202003116268221','202003118342519','202003119615968','202003118354122','202003118883767','202003117647797','202003117044931','202003118608259','202003113961402','202003113972940','202003119269057','202003115921989','202003114919791','202003116020625','202003119580777','202003117063107','202003113997623','202003111644579','202003115947803','202003116479723','202003111053870')) union select FINANCE_EXTRACT_ID,replace(PREMIUM_INDICATOR, '-', '_') AS PREMIUM_INDICATOR,'IGST' AS PREMIUM_BREAKDOWN_INDICATOR, CAST(iGstAmount as DECIMAL(10,2))  AS AMOUNT,IGST_RATE AS GST_RATE,case WHEN YOP = 0 THEN 1 ELSE YOP END AS YOP from financeadapter_breakdown where PREMIUM_INDICATOR != 'MEDICAL'  and iGstAmount > 0.0 and  FINANCE_EXTRACT_ID in (SELECT FINANCE_EXTRACT_ID from financeadapter_activity a  where  a.FINANCE_EXTRACT_ID in  ('202003117088266','202003119388786','202003114805649','202003118207528','202003118695036','202003115717325','202003118734198','202003119369422','202003115314403','202003116268221','202003118342519','202003119615968','202003118354122','202003118883767','202003117647797','202003117044931','202003118608259','202003113961402','202003113972940','202003119269057','202003115921989','202003114919791','202003116020625','202003119580777','202003117063107','202003113997623','202003111644579','202003115947803','202003116479723','202003111053870')) union select FINANCE_EXTRACT_ID,replace(PREMIUM_INDICATOR, '-', '_') AS PREMIUM_INDICATOR,'UGST' AS PREMIUM_BREAKDOWN_INDICATOR, CAST(uGstAmount as DECIMAL(10,2))  AS AMOUNT,UGST_RATE AS GST_RATE,case WHEN YOP = 0 THEN 1 ELSE YOP END AS YOP from financeadapter_breakdown where PREMIUM_INDICATOR != 'MEDICAL'  and uGstAmount > 0.0 and  FINANCE_EXTRACT_ID in (SELECT FINANCE_EXTRACT_ID from financeadapter_activity a  where  a.FINANCE_EXTRACT_ID in  ('202003117088266','202003119388786','202003114805649','202003118207528','202003118695036','202003115717325','202003118734198','202003119369422','202003115314403','202003116268221','202003118342519','202003119615968','202003118354122','202003118883767','202003117647797','202003117044931','202003118608259','202003113961402','202003113972940','202003119269057','202003115921989','202003114919791','202003116020625','202003119580777','202003117063107','202003113997623','202003111644579','202003115947803','202003116479723','202003111053870')) union select FINANCE_EXTRACT_ID,replace(PREMIUM_INDICATOR, '-', '_') AS PREMIUM_INDICATOR,'STAMP_DUTY' AS PREMIUM_BREAKDOWN_INDICATOR, CAST(stampDutyAmount as DECIMAL(10,2))  AS AMOUNT,'' AS GST_RATE,case WHEN YOP = 0 THEN 1 ELSE YOP END AS YOP from financeadapter_breakdown where PREMIUM_INDICATOR != 'MEDICAL'  and stampDutyAmount > 0.0 and  FINANCE_EXTRACT_ID in (SELECT FINANCE_EXTRACT_ID from financeadapter_activity a  where  a.FINANCE_EXTRACT_ID in  ('202003117088266','202003119388786','202003114805649','202003118207528','202003118695036','202003115717325','202003118734198','202003119369422','202003115314403','202003116268221','202003118342519','202003119615968','202003118354122','202003118883767','202003117647797','202003117044931','202003118608259','202003113961402','202003113972940','202003119269057','202003115921989','202003114919791','202003116020625','202003119580777','202003117063107','202003113997623','202003111644579','202003115947803','202003116479723','202003111053870')) union select FINANCE_EXTRACT_ID,'MEDICAL' AS PREMIUM_INDICATOR,'MEDICAL_FEES' AS PREMIUM_BREAKDOWN_INDICATOR, CAST(AMOUNT as DECIMAL(10,2))  AS AMOUNT, '' AS GST_RATE,case WHEN YOP = 0 THEN 1 ELSE YOP END AS YOP from financeadapter_breakdown where PREMIUM_INDICATOR = 'MEDICAL'  and AMOUNT > 0.0 and  FINANCE_EXTRACT_ID in (SELECT FINANCE_EXTRACT_ID from financeadapter_activity a  where  a.FINANCE_EXTRACT_ID in ('202003117088266','202003119388786','202003114805649','202003118207528','202003118695036','202003115717325','202003118734198','202003119369422','202003115314403','202003116268221','202003118342519','202003119615968','202003118354122','202003118883767','202003117647797','202003117044931','202003118608259','202003113961402','202003113972940','202003119269057','202003115921989','202003114919791','202003116020625','202003119580777','202003117063107','202003113997623','202003111644579','202003115947803','202003116479723','202003111053870'))"
		}
	]
}
